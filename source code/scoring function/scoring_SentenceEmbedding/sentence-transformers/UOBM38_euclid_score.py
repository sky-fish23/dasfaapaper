Kset = set()

with open("./UOBM/UOBM38/MCS1") as f:
    K1 = f.read().split("\n\n")
    for axiom in K1:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS2") as f:
    K2 = f.read().split("\n\n")
    for axiom in K2:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS3") as f:
    K3 = f.read().split("\n\n")
    for axiom in K3:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS4") as f:
    K4 = f.read().split("\n\n")
    for axiom in K4:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS5") as f:
    K5 = f.read().split("\n\n")
    for axiom in K5:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS6") as f:
    K6 = f.read().split("\n\n")
    for axiom in K6:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS7") as f:
    K7 = f.read().split("\n\n")
    for axiom in K7:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS8") as f:
    K8 = f.read().split("\n\n")
    for axiom in K8:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS9") as f:
    K9 = f.read().split("\n\n")
    for axiom in K9:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS10") as f:
    K10 = f.read().split("\n\n")
    for axiom in K10:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS11") as f:
    K11 = f.read().split("\n\n")
    for axiom in K11:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS12") as f:
    K12 = f.read().split("\n\n")
    for axiom in K12:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS13") as f:
    K13 = f.read().split("\n\n")
    for axiom in K13:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS14") as f:
    K14 = f.read().split("\n\n")
    for axiom in K14:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS15") as f:
    K15 = f.read().split("\n\n")
    for axiom in K15:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS16") as f:
    K16 = f.read().split("\n\n")
    for axiom in K16:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS17") as f:
    K17 = f.read().split("\n\n")
    for axiom in K17:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS18") as f:
    K18 = f.read().split("\n\n")
    for axiom in K18:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS19") as f:
    K19 = f.read().split("\n\n")
    for axiom in K19:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS20") as f:
    K20 = f.read().split("\n\n")
    for axiom in K20:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS21") as f:
    K21 = f.read().split("\n\n")
    for axiom in K21:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS22") as f:
    K22 = f.read().split("\n\n")
    for axiom in K22:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS23") as f:
    K23 = f.read().split("\n\n")
    for axiom in K23:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS24") as f:
    K24 = f.read().split("\n\n")
    for axiom in K24:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS25") as f:
    K25 = f.read().split("\n\n")
    for axiom in K25:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS26") as f:
    K26 = f.read().split("\n\n")
    for axiom in K26:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS27") as f:
    K27 = f.read().split("\n\n")
    for axiom in K27:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS28") as f:
    K28 = f.read().split("\n\n")
    for axiom in K28:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS29") as f:
    K29 = f.read().split("\n\n")
    for axiom in K29:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS30") as f:
    K30 = f.read().split("\n\n")
    for axiom in K30:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS31") as f:
    K31 = f.read().split("\n\n")
    for axiom in K31:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS32") as f:
    K32 = f.read().split("\n\n")
    for axiom in K32:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS33") as f:
    K33 = f.read().split("\n\n")
    for axiom in K33:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS34") as f:
    K34 = f.read().split("\n\n")
    for axiom in K34:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS35") as f:
    K35 = f.read().split("\n\n")
    for axiom in K35:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS36") as f:
    K36 = f.read().split("\n\n")
    for axiom in K36:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS37") as f:
    K37 = f.read().split("\n\n")
    for axiom in K37:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS38") as f:
    K38 = f.read().split("\n\n")
    for axiom in K38:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS39") as f:
    K39 = f.read().split("\n\n")
    for axiom in K39:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS40") as f:
    K40 = f.read().split("\n\n")
    for axiom in K40:
        Kset.add(axiom)
    f.close()


with open("./UOBM/UOBM38/MCS41") as f:
    K41 = f.read().split("\n\n")
    for axiom in K41:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS42") as f:
    K42 = f.read().split("\n\n")
    for axiom in K42:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS43") as f:
    K43 = f.read().split("\n\n")
    for axiom in K43:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS44") as f:
    K44 = f.read().split("\n\n")
    for axiom in K44:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS45") as f:
    K45 = f.read().split("\n\n")
    for axiom in K45:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS46") as f:
    K46 = f.read().split("\n\n")
    for axiom in K46:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS47") as f:
    K47 = f.read().split("\n\n")
    for axiom in K47:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS48") as f:
    K48 = f.read().split("\n\n")
    for axiom in K48:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS49") as f:
    K49 = f.read().split("\n\n")
    for axiom in K49:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS50") as f:
    K50 = f.read().split("\n\n")
    for axiom in K50:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS51") as f:
    K51 = f.read().split("\n\n")
    for axiom in K51:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS52") as f:
    K52 = f.read().split("\n\n")
    for axiom in K52:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS53") as f:
    K53 = f.read().split("\n\n")
    for axiom in K53:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS54") as f:
    K54 = f.read().split("\n\n")
    for axiom in K54:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS55") as f:
    K55 = f.read().split("\n\n")
    for axiom in K55:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS56") as f:
    K56 = f.read().split("\n\n")
    for axiom in K56:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS57") as f:
    K57 = f.read().split("\n\n")
    for axiom in K57:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS58") as f:
    K58 = f.read().split("\n\n")
    for axiom in K58:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS59") as f:
    K59 = f.read().split("\n\n")
    for axiom in K59:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS60") as f:
    K60 = f.read().split("\n\n")
    for axiom in K60:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS61") as f:
    K61 = f.read().split("\n\n")
    for axiom in K61:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS62") as f:
    K62 = f.read().split("\n\n")
    for axiom in K62:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS63") as f:
    K63 = f.read().split("\n\n")
    for axiom in K63:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS64") as f:
    K64 = f.read().split("\n\n")
    for axiom in K64:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS65") as f:
    K65 = f.read().split("\n\n")
    for axiom in K65:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS66") as f:
    K66 = f.read().split("\n\n")
    for axiom in K66:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS67") as f:
    K67 = f.read().split("\n\n")
    for axiom in K67:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS68") as f:
    K68 = f.read().split("\n\n")
    for axiom in K68:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS69") as f:
    K69 = f.read().split("\n\n")
    for axiom in K69:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS70") as f:
    K70 = f.read().split("\n\n")
    for axiom in K70:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS71") as f:
    K71 = f.read().split("\n\n")
    for axiom in K71:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS72") as f:
    K72 = f.read().split("\n\n")
    for axiom in K72:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS73") as f:
    K73 = f.read().split("\n\n")
    for axiom in K73:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS74") as f:
    K74 = f.read().split("\n\n")
    for axiom in K74:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS75") as f:
    K75 = f.read().split("\n\n")
    for axiom in K75:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS76") as f:
    K76 = f.read().split("\n\n")
    for axiom in K76:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS77") as f:
    K77 = f.read().split("\n\n")
    for axiom in K77:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS78") as f:
    K78 = f.read().split("\n\n")
    for axiom in K78:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS79") as f:
    K79 = f.read().split("\n\n")
    for axiom in K79:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS80") as f:
    K80 = f.read().split("\n\n")
    for axiom in K80:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS81") as f:
    K81 = f.read().split("\n\n")
    for axiom in K81:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS82") as f:
    K82 = f.read().split("\n\n")
    for axiom in K82:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS83") as f:
    K83 = f.read().split("\n\n")
    for axiom in K83:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS84") as f:
    K84 = f.read().split("\n\n")
    for axiom in K84:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS85") as f:
    K85 = f.read().split("\n\n")
    for axiom in K85:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS86") as f:
    K86 = f.read().split("\n\n")
    for axiom in K86:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS87") as f:
    K87 = f.read().split("\n\n")
    for axiom in K87:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS88") as f:
    K88 = f.read().split("\n\n")
    for axiom in K88:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS89") as f:
    K89 = f.read().split("\n\n")
    for axiom in K89:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS90") as f:
    K90 = f.read().split("\n\n")
    for axiom in K90:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS91") as f:
    K91 = f.read().split("\n\n")
    for axiom in K91:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS92") as f:
    K92 = f.read().split("\n\n")
    for axiom in K92:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS93") as f:
    K93 = f.read().split("\n\n")
    for axiom in K93:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS94") as f:
    K94 = f.read().split("\n\n")
    for axiom in K94:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS95") as f:
    K95 = f.read().split("\n\n")
    for axiom in K95:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS96") as f:
    K96 = f.read().split("\n\n")
    for axiom in K96:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS97") as f:
    K97 = f.read().split("\n\n")
    for axiom in K97:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS98") as f:
    K98 = f.read().split("\n\n")
    for axiom in K98:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS99") as f:
    K99 = f.read().split("\n\n")
    for axiom in K99:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS100") as f:
    K100 = f.read().split("\n\n")
    for axiom in K100:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS101") as f:
    K101 = f.read().split("\n\n")
    for axiom in K101:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS102") as f:
    K102 = f.read().split("\n\n")
    for axiom in K102:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS103") as f:
    K103 = f.read().split("\n\n")
    for axiom in K103:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS104") as f:
    K104 = f.read().split("\n\n")
    for axiom in K104:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS105") as f:
    K105 = f.read().split("\n\n")
    for axiom in K105:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS106") as f:
    K106 = f.read().split("\n\n")
    for axiom in K106:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS107") as f:
    K107 = f.read().split("\n\n")
    for axiom in K107:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS108") as f:
    K108 = f.read().split("\n\n")
    for axiom in K108:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS109") as f:
    K109 = f.read().split("\n\n")
    for axiom in K109:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS110") as f:
    K110 = f.read().split("\n\n")
    for axiom in K110:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS111") as f:
    K111 = f.read().split("\n\n")
    for axiom in K111:
        Kset.add(axiom)
    f.close()

with open("./UOBM/UOBM38/MCS112") as f:
    K112 = f.read().split("\n\n")
    for axiom in K112:
        Kset.add(axiom)
    f.close()

K = list(Kset)
mc_K = [K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11,K12,K13,K14,K15,K16,K17,K18,K19,K20,K21,K22,K23,K24,K25,K26,K27,K28,K29,K30,K31,K32,K33,K34,K35,K36,K37,K38,K39,K40,K41,K42,K43,K44,K45,K46,K47,K48,K49,K50,K51,K52,K53,K54,K55,K56,K57,K58,K59,K60,K61,K62,K63,K64,K65,K66,K67,K68,K69,K70,K71,K72,K73,K74,K75,K76,K77,K78,K79,K80,K81,K82,K83,K84,K85,K86,K87,K88,K89,K90,K91,K92,K93,K94,K95,K96,K97,K98,K99,K100,K101,K102,K103,K104,K105,K106,K107,K108,K109,K110,K111,K112]

print("data loaded!")

import sys

sys.path.append('..')
from sentence_transformers import SentenceTransformer, LoggingHandler
import numpy as np
import logging
import time

'''
sim_model = Similarity()

def sim(s1, s2):
    return sim_model.get_score(s1, s2)

mat = [([0] * len(K)) for i in range(len(K))]
'''
sent_index = {}
index_sent = {}
index = 0
for sentence in K:
    sent_index[sentence] = index
    index_sent[index] = sentence
    index += 1
'''
for i in range(len(K)):
    for j in range(i, len(K)):
        mat[i][j] = sim(index_sent[i], index_sent[j])

for i in range(len(K)):
    for j in range(i):
        mat[i][j] = mat[j][i]
'''
                                                      
#model = SentenceTransformer('paraphrase-albert-small-v2')  # albert
model = SentenceTransformer('all-distilroberta-v1')          # RoBERTa

sentence_embeddings = model.encode(K)

# sent_bert_scores = model1.similarity(K, K)

mat = [([0] * len(K)) for i in range(len(K))]

def cos_sim(s1, s2):
    v1 = np.array(sentence_embeddings[sent_index[s1]])
    v2 = np.array(sentence_embeddings[sent_index[s2]])
    v = sum(v1*v2) / ((sum(v1**2) * sum(v2**2))**0.5)
    return (1+v) / 2

def euc_sim(s1, s2):
    v1 = np.array(sentence_embeddings[sent_index[s1]])
    v2 = np.array(sentence_embeddings[sent_index[s2]])
    return 1 / (1 + (sum((v1-v2)**2))**0.5)

for i in range(len(K)):
    for j in range(i, len(K)):
        mat[i][j] = euc_sim(index_sent[i], index_sent[j])

for i in range(len(K)):
    for j in range(i):
        mat[i][j] = mat[j][i]

print("similarity compute completed! ")

print("Sentence-BERT ########################################")
######################### Method 1 ###################################

def agg_all(Ki, alpha):
    res = 0
    for beta in Ki:
        res += mat[sent_index[beta]][sent_index[alpha]]
    return res / len(Ki)


def mc_all(alpha):
    return sum([(agg_all(Ki, alpha) + 1) for Ki in mc_K])

def score_all(Ki):
    res = 0
    for alpha in Ki:
        mc = mc_all(alpha)
        res += mc
    return res


cnt = 1
for Ki in mc_K:
    print("Method 1 K{0}  score: {1}".format(cnt, score_all(Ki)))
    cnt += 1

######################### Method 2 ###################################

def equalHead(alpha, beta):
    if len(alpha) == 0 and len(beta) == 0:
        return True
    if len(alpha) == 0 or len(beta) == 0:
        return False
    return alpha.split()[0] == beta.split()[0]

def equalTail(alpha, beta):
    if len(alpha) == 0 and len(beta) == 0:
        return True
    if len(alpha) == 0 or len(beta) == 0:
        return False
    return alpha.split()[-1] == beta.split()[-1]

def H(Ki, alpha):
    h = []
    for beta in Ki:
        if equalHead(beta, alpha):
            h.append(beta)
    return h

def T(Ki, alpha):
    t = []
    for beta in Ki:
        if equalTail(beta, alpha):
            t.append(beta)
    return t

def agg_local_H(Ki, alpha):
    h = H(Ki, alpha)
    if len(h) == 0:
        return 0
    else:
        return sum([mat[sent_index[alpha]][sent_index[beta]] for beta in h]) / len(h)

def agg_local_T(Ki, alpha):
    t = T(Ki, alpha)
    if len(t) == 0:
        return 0
    else:
        return sum([mat[sent_index[alpha]][sent_index[beta]] for beta in t]) / len(t)


def mc_local(alpha):
    res = 0
    for Ki in mc_K:
        if alpha in Ki:
            res += ((agg_local_H(Ki, alpha)+agg_local_T(Ki, alpha))/2 + 1)
    return res

def score_local(Ki):
    res = 0
    for alpha in Ki:
        mc = mc_local(alpha)
        res += mc
    return res

cnt = 1
for Ki in mc_K:
    print("Method 2 K{0}  score: {1}".format(cnt, score_local(Ki)))
    cnt += 1
